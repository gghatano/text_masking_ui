# 医療テキスト匿名化ツール

医療分野のテキストデータから個人情報（人名）を自動的に検出し、匿名化するためのWebアプリケーションです。医療用語（病名、症例名など）は保持しながら、個人情報のみをマスキングします。

## 概要

本ツールは日本語自然言語処理ライブラリ「GiNZA」をベースに、医療テキスト向けにカスタマイズされた固有表現抽出モデルを使用しています。医療文書に特有の病名や検査名などの用語を保持したまま、人名のみを検出して匿名化処理を行います。

### 主な特徴

- 医療用語（〇〇病、〇〇式、〇〇法、〇〇分類など）と人名の区別が可能
- Excelからコピー＆ペーストしたデータを行単位で処理
- 処理結果をExcelファイルとしてダウンロード可能
- Streamlitを使用した使いやすいWebインターフェース

## インストール方法

### 必要条件

- Python 3.8以上
- pip（Pythonパッケージ管理ツール）

### セットアップ手順

1. リポジトリをクローンするか、ダウンロードします

```bash
git clone <リポジトリURL>
cd text_masking_ui
```

2. 仮想環境を作成し、アクティベートします（推奨）

```bash
python -m venv .venv
# Windowsの場合
.venv\Scripts\activate
# macOS/Linuxの場合
source .venv/bin/activate
```

3. 必要なパッケージをインストールします

```bash
pip install -r requirements.txt
```

4. カスタム固有表現抽出モデルを学習します

```bash
python train_model.py
```

## 使用方法

1. アプリケーションを起動します

```bash
streamlit run app.py
```

2. ブラウザが自動的に開き、アプリケーションのUIが表示されます（通常はhttp://localhost:8501）

3. テキスト入力エリアに以下のいずれかの方法でテキストを入力します
   - 直接テキストを入力
   - Excelからデータをコピー＆ペースト

4. 「匿名化を実行」ボタンをクリックすると、人名のみが`[匿_人名]`としてマスキングされた結果が表示されます

5. 「Excelとしてダウンロード」ボタンをクリックすると、処理結果をExcelファイルとして保存できます

## カスタマイズ方法

### モデルのカスタマイズ

`train_model.py`ファイルを修正することで、特定の医療用語や人名パターンをモデルに追加することができます。

```python
# **除外する名前リスト**に新しいカテゴリや名前を追加
EXCLUDED_NAMES = {
    "〇〇式": ["長谷川", "杉岡", "吉田", "田中", "佐藤", "新しい名前"],
    # 他のカテゴリも同様に追加可能
}

# **カスタムNER学習用データセット**に新しい例文を追加
TRAIN_DATA = [
    # 既存のデータに加えて、新しい例文と教師データを追加
    ("新しい例文", {"entities": [(開始位置, 終了位置, "ラベル")]})
]
```

変更後は再度`python train_model.py`を実行してモデルを再学習してください。

### UIのカスタマイズ

`app.py`ファイルを修正することで、UIの表示方法やマスキング方法をカスタマイズできます。

```python
# マスキング方法の変更例
if ent_label in ["Person", "PERSON"]:
    text = text.replace(ent_text, "[匿_人名]")  # ここのマスキング文字列を変更
```

## トラブルシューティング

- **モデルが見つからないエラー**: `ja_ginza_custom` モデルが見つからない場合は、`python train_model.py`を実行してモデルを作成してください。

- **依存関係のエラー**: パッケージが正しくインストールされていない場合は、`pip install -r requirements.txt`コマンドを再実行してください。

- **メモリ不足エラー**: 大量のテキストを処理する場合は、小さなバッチに分けて処理することをお勧めします。

## 免責事項

本ソフトウェアは「現状のまま」提供されており、明示または暗黙を問わず、いかなる種類の保証も伴いません。これには、商品性、特定目的への適合性、および権利侵害の不存在についての保証が含まれますが、これらに限定されません。

- 本ツールは医療テキストの匿名化を支援するものですが、100%の精度を保証するものではありません。重要なデータの処理には、必ず結果を人間が確認してください。
- 法的要件やプライバシー基準を満たすための使用については、ユーザー自身の責任で適切な評価を行ってください。
- 特に医療情報の取り扱いには関連法規制を遵守する必要があります。本ツールの使用が適用される規制に準拠していることを確認するのはユーザーの責任です。

## ライセンス

本プロジェクトはMITライセンスの下で公開されています。詳細は[LICENSE](LICENSE)ファイルをご覧ください。

## コントリビューション

バグ報告や機能追加の提案は、IssueやPull Requestを通じて歓迎します。コントリビューションの前に、プロジェクトのガイドラインを確認してください。
